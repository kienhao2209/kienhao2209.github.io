<!doctype html><html lang=vi class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.142.0"><meta name=description content><meta name=author content="journeyoftheaverageguy@gmail.com"><link rel=icon href=/images/favicon.png type=image/png><title>Tạo Lambda Function #2 :: AWS System Manager</title>
<link href=/css/nucleus.css?1754755521 rel=stylesheet><link href=/css/fontawesome-all.min.css?1754755521 rel=stylesheet><link href=/css/hybrid.css?1754755521 rel=stylesheet><link href=/css/featherlight.min.css?1754755521 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1754755521 rel=stylesheet><link href=/css/auto-complete.css?1754755521 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1754755521 rel=stylesheet><link href=/css/theme.css?1754755521 rel=stylesheet><link href=/css/hugo-theme.css?1754755521 rel=stylesheet><link href=/css/theme-workshop.css?1754755521 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1754755521></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/vi/3-aipoweredinvoiceprocessing/3.4-createlambdafunction-fetch/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=/><svg id="Layer_1" data-name="Layer 1" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff}.cls-2{fill:#f90;fill-rule:evenodd}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09 10.85a4.7 4.7.0 00.19 1.48 7.73 7.73.0 00.54 1.19.77.77.0 01.12.38.64.64.0 01-.32.49l-1 .7a.83.83.0 01-.44.15.69.69.0 01-.49-.23 3.8 3.8.0 01-.6-.77q-.25-.42-.51-1a6.14 6.14.0 01-4.89 2.3 4.54 4.54.0 01-3.32-1.19 4.27 4.27.0 01-1.22-3.2 4.28 4.28.0 011.46-3.4A6.06 6.06.0 017.69 6.46a12.47 12.47.0 011.76.13q.92.13 1.91.36V5.73a3.65 3.65.0 00-.79-2.66A3.81 3.81.0 007.86 2.3a7.71 7.71.0 00-1.79.22 12.78 12.78.0 00-1.79.57 4.55 4.55.0 01-.58.22h-.26q-.35.0-.35-.52V2a1.09 1.09.0 01.12-.58 1.2 1.2.0 01.47-.35A10.88 10.88.0 015.77.32 10.19 10.19.0 018.36.0a6 6 0 014.35 1.35 5.49 5.49.0 011.38 4.09zM7.34 13.38a5.36 5.36.0 001.72-.31A3.63 3.63.0 0010.63 12 2.62 2.62.0 0011.19 11a5.63 5.63.0 00.16-1.44v-.7a14.35 14.35.0 00-1.53-.28 12.37 12.37.0 00-1.56-.1 3.84 3.84.0 00-2.47.67A2.34 2.34.0 005 11a2.35 2.35.0 00.61 1.76A2.4 2.4.0 007.34 13.38zm13.35 1.8a1 1 0 01-.64-.16 1.3 1.3.0 01-.35-.65L15.81 1.51a3 3 0 01-.15-.67.36.36.0 01.41-.41H17.7a1 1 0 01.65.16 1.4 1.4.0 01.33.65l2.79 11 2.59-11A1.17 1.17.0 0124.39.6a1.1 1.1.0 01.67-.16H26.4a1.1 1.1.0 01.67.16 1.17 1.17.0 01.32.65L30 12.39 32.88 1.25A1.39 1.39.0 0133.22.6a1 1 0 01.65-.16h1.54a.36.36.0 01.41.41 1.36 1.36.0 010 .26 3.64 3.64.0 01-.12.41l-4 12.86a1.3 1.3.0 01-.35.65 1 1 0 01-.64.16H29.25a1 1 0 01-.67-.17 1.26 1.26.0 01-.32-.67L25.67 3.64l-2.56 10.7a1.26 1.26.0 01-.32.67 1 1 0 01-.67.17zm21.36.44a11.28 11.28.0 01-2.56-.29 7.44 7.44.0 01-1.92-.67 1 1 0 01-.61-.93v-.84q0-.52.38-.52a.9.9.0 01.31.06l.42.17a8.77 8.77.0 001.83.58 9.78 9.78.0 002 .2 4.48 4.48.0 002.43-.55 1.76 1.76.0 00.86-1.57 1.61 1.61.0 00-.45-1.16A4.29 4.29.0 0043 9.22l-2.41-.76A5.15 5.15.0 0138 6.78a3.94 3.94.0 01-.83-2.41 3.7 3.7.0 01.45-1.85 4.47 4.47.0 011.19-1.37 5.27 5.27.0 011.7-.86A7.4 7.4.0 0142.6.0a8.87 8.87.0 011.12.07q.57.07 1.08.19t.95.26a4.27 4.27.0 01.7.29 1.59 1.59.0 01.49.41.94.94.0 01.15.55v.79q0 .52-.38.52a1.76 1.76.0 01-.64-.2 7.74 7.74.0 00-3.2-.64 4.37 4.37.0 00-2.21.47 1.6 1.6.0 00-.79 1.48 1.58 1.58.0 00.49 1.18 4.94 4.94.0 001.83.92L44.55 7a5.08 5.08.0 012.57 1.6A3.76 3.76.0 0147.9 11a4.21 4.21.0 01-.44 1.93 4.4 4.4.0 01-1.21 1.47 5.43 5.43.0 01-1.85.93A8.25 8.25.0 0142.05 15.62z"/><path class="cls-2" d="M45.19 23.81C39.72 27.85 31.78 30 25 30A36.64 36.64.0 01.22 20.57c-.51-.46-.06-1.09.56-.74A49.78 49.78.0 0025.53 26.4 49.23 49.23.0 0044.4 22.53C45.32 22.14 46.1 23.14 45.19 23.81z"/><path class="cls-2" d="M47.47 21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74 3.13-2.2 8.27-1.57 8.86-.83s-.16 5.89-3.09 8.35c-.45.38-.88.18-.68-.32C46.69 25.8 48.17 22.11 47.47 21.21z"/></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1754755521></script><script type=text/javascript src=/js/auto-complete.js?1754755521></script><script type=text/javascript>var baseurl="//vi"</script><script type=text/javascript src=/js/search.js?1754755521></script></div><div class=highlightable><ul class=topics><li data-nav-id=/vi/1-introduce/ title="Giới thiệu" class=dd-item><a href=/vi/1-introduce/><b>1. </b>Giới thiệu
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/2-environmentsetup/ title="Chuẩn bị môi trường" class=dd-item><a href=/vi/2-environmentsetup/><b>2. </b>Chuẩn bị môi trường
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/2-environmentsetup/2.1-createpolicy/ title="Tạo IAM Policies" class=dd-item><a href=/vi/2-environmentsetup/2.1-createpolicy/><b>2.1 </b>Tạo IAM Policies
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/2-environmentsetup/2.2-createiamuserandattachpolicy/ title="Tạo IAM User và cấp quyền" class=dd-item><a href=/vi/2-environmentsetup/2.2-createiamuserandattachpolicy/><b>2.2 </b>Tạo IAM User và cấp quyền
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/2-environmentsetup/2.3-loginwithiamuser/ title="Đăng nhập IAM User" class=dd-item><a href=/vi/2-environmentsetup/2.3-loginwithiamuser/><b>2.3 </b>Đăng nhập IAM User
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/2-environmentsetup/2.4-creates3bucketforinvoices/ title="Tạo S3 Bucket" class=dd-item><a href=/vi/2-environmentsetup/2.4-creates3bucketforinvoices/><b>2.4 </b>Tạo S3 Bucket
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/2-environmentsetup/2.5-createdynamodbtableforinvoices/ title="Tạo DynamoDB Table" class=dd-item><a href=/vi/2-environmentsetup/2.5-createdynamodbtableforinvoices/><b>2.5 </b>Tạo DynamoDB Table
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/2-environmentsetup/2.6-requestnovaproaccess/ title="Kích hoạt Nova Pro" class=dd-item><a href=/vi/2-environmentsetup/2.6-requestnovaproaccess/><b>2.6 </b>Kích hoạt Nova Pro
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/3-aipoweredinvoiceprocessing/ title="Xử lý Hóa Đơn bằng AI" class="dd-item
parent"><a href=/vi/3-aipoweredinvoiceprocessing/><b>3. </b>Xử lý Hóa Đơn bằng AI
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/3-aipoweredinvoiceprocessing/3.1-createlambdarole/ title="Tạo IAM Role cho Lambda" class=dd-item><a href=/vi/3-aipoweredinvoiceprocessing/3.1-createlambdarole/><b>3.1 </b>Tạo IAM Role cho Lambda
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-aipoweredinvoiceprocessing/3.2-createlambdafunction-upload/ title="Tạo Lambda Function #1" class=dd-item><a href=/vi/3-aipoweredinvoiceprocessing/3.2-createlambdafunction-upload/><b>3.2 </b>Tạo Lambda Function #1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-aipoweredinvoiceprocessing/3.3-testlambdafunction-upload/ title="Kiểm thử Lambda Function #1" class=dd-item><a href=/vi/3-aipoweredinvoiceprocessing/3.3-testlambdafunction-upload/><b>3.3 </b>Kiểm thử Lambda Function #1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-aipoweredinvoiceprocessing/3.4-createlambdafunction-fetch/ title="Tạo Lambda Function #2" class="dd-item
active"><a href=/vi/3-aipoweredinvoiceprocessing/3.4-createlambdafunction-fetch/><b>3.4 </b>Tạo Lambda Function #2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-aipoweredinvoiceprocessing/3.5-testlambdafunction-fetch/ title="Kiểm thử Lambda Function #2" class=dd-item><a href=/vi/3-aipoweredinvoiceprocessing/3.5-testlambdafunction-fetch/><b>3.5 </b>Kiểm thử Lambda Function #2
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/4-deployingapigateway/ title="Triển khai API Gateway" class=dd-item><a href=/vi/4-deployingapigateway/><b>4. </b>Triển khai API Gateway
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/4-deployingapigateway/4.1-creategetapigateway/ title="Tạo API Gateway (GET)" class=dd-item><a href=/vi/4-deployingapigateway/4.1-creategetapigateway/><b>4.1 </b>Tạo API Gateway (GET)
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/4-deployingapigateway/4.2-createpostapigateway/ title="Tạo API Gateway (POST)" class=dd-item><a href=/vi/4-deployingapigateway/4.2-createpostapigateway/><b>4.2 </b>Tạo API Gateway (POST)
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/5-testwithpostman/ title="Kiểm thử với Postman" class=dd-item><a href=/vi/5-testwithpostman/><b>5. </b>Kiểm thử với Postman
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/5-testwithpostman/5.1-testuploadfile/ title="Kiểm thử tải tệp hóa đơn" class=dd-item><a href=/vi/5-testwithpostman/5.1-testuploadfile/><b>5.1 </b>Kiểm thử tải tệp hóa đơn
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-testwithpostman/5.2-testgetallinvoices/ title="Kiểm thử lấy tất cả hóa đơn" class=dd-item><a href=/vi/5-testwithpostman/5.2-testgetallinvoices/><b>5.2 </b>Kiểm thử lấy tất cả hóa đơn
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-testwithpostman/5.3-testgetinvoiceid/ title="Kiểm thử lấy invoice theo ID" class=dd-item><a href=/vi/5-testwithpostman/5.3-testgetinvoiceid/><b>5.3 </b>Kiểm thử lấy invoice theo ID
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-testwithpostman/5.4-testgetinvoicesstarred/ title="Kiểm thử lấy danh sách hóa đơn đánh dấu" class=dd-item><a href=/vi/5-testwithpostman/5.4-testgetinvoicesstarred/><b>5.4 </b>Kiểm thử lấy danh sách hóa đơn đánh dấu
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-testwithpostman/5.5-testupdatestatusstarred/ title="Kiểm thử cập nhật trạng thái đánh dấu hóa đơn" class=dd-item><a href=/vi/5-testwithpostman/5.5-testupdatestatusstarred/><b>5.5 </b>Kiểm thử cập nhật trạng thái đánh dấu hóa đơn
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-testwithpostman/5.6-testupdatetags/ title="Kiểm thử cập nhật danh mục hóa đơn" class=dd-item><a href=/vi/5-testwithpostman/5.6-testupdatetags/><b>5.6 </b>Kiểm thử cập nhật danh mục hóa đơn
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-testwithpostman/5.7-testgetinvoicebyname/ title="Kiểm thử lấy hóa đơn theo tên khách hàng" class=dd-item><a href=/vi/5-testwithpostman/5.7-testgetinvoicebyname/><b>5.7 </b>Kiểm thử lấy hóa đơn theo tên khách hàng
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/6-deployingfrontend/ title="Triển khai Frontend" class=dd-item><a href=/vi/6-deployingfrontend/><b>6 </b>Triển khai Frontend
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/7-cleanup/ title="Dọn dẹp tài nguyên" class=dd-item><a href=/vi/7-cleanup/><b>7. </b>Dọn dẹp tài nguyên
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/7-cleanup/7.1-removeapigateway/ title="Xóa API Gateway" class=dd-item><a href=/vi/7-cleanup/7.1-removeapigateway/><b>7.1 </b>Xóa API Gateway
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/7-cleanup/7.2-removelambdafunction/ title="Xóa Lambda Functions" class=dd-item><a href=/vi/7-cleanup/7.2-removelambdafunction/><b>7.2 </b>Xóa Lambda Functions
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/7-cleanup/7.3-removedynamodb/ title="Xóa DynamoDB" class=dd-item><a href=/vi/7-cleanup/7.3-removedynamodb/><b>7.3 </b>Xóa DynamoDB
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/7-cleanup/7.4-removes3bucket/ title="Xóa S3 Bucket" class=dd-item><a href=/vi/7-cleanup/7.4-removes3bucket/><b>7.4 </b>Xóa S3 Bucket
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/7-cleanup/7.5-removecloudwatch/ title="Xóa CloudWatch Alarms" class=dd-item><a href=/vi/7-cleanup/7.5-removecloudwatch/><b>7.5 </b>Xóa CloudWatch Alarms
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/7-cleanup/7.6-removeiam/ title="Xóa IAM User và Policy" class=dd-item><a href=/vi/7-cleanup/7.6-removeiam/><b>7.6 </b>Xóa IAM User và Policy
<i class="fas fa-check read-icon"></i></a></li></ul></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://www.facebook.com/groups/awsstudygroupfcj/><i class='fab fa-facebook'></i> AWS Study Group</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value"><option id=en value=/3-aipoweredinvoiceprocessing/3.4-createlambdafunction-fetch/>English</option><option id=vi value=/vi/3-aipoweredinvoiceprocessing/3.4-createlambdafunction-fetch/ selected>Tiếng Việt</option></select><svg id="Capa_1" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><left><b>Workshop</b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title=Migrate alt="web counter" border=0></a><br><b><a href=https://cloudjourney.awsstudygroup.com/>Cloud Journey</a></b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" alt="web counter" border=0>
</left><left><br><br><b>Last Updated</b><br><i><font color=orange>30-01-2022</font></i>
</left><left><br><br><b>Team</b><br><i><a href=https://www.linkedin.com/in/sutrinh/ style=color:orange>Sử Trịnh</a><br><a href=https://www.linkedin.com/in/jotaguy style=color:orange>Gia Hưng</a><br><a href=https://www.linkedin.com/in/hiepnguyendt style=color:orange>Thanh Hiệp </a></i></left><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i>
</a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=/vi/>Xây dựng hệ thống quét hóa đơn AI trên kiến trúc Serverless</a> > <a href=/vi/3-aipoweredinvoiceprocessing/>Xử lý Hóa Đơn bằng AI</a> > Tạo Lambda Function #2</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Tạo Lambda Function #2</h1><h4 id=tổng-quan>Tổng quan</h4><p>Trong bước này, bạn sẽ tạo Lambda Function thứ hai có tên <strong>FetchInvoiceDetailsFunction</strong>. Function này có nhiệm vụ truy vấn hoặc cập nhật thông tin hóa đơn trong DynamoDB, phục vụ cho các yêu cầu từ API Gateway.</p><hr><h4 id=bước-1-truy-cập-lambda-console>Bước 1: Truy cập Lambda Console</h4><ol><li>Mở <a href=https://console.aws.amazon.com/lambda/>AWS Lambda Console</a></li></ol><p><img src=/images/3.lambdafunctions/3.4-fetchinvoicelambda/001-openlambda.png alt="Open Lambda Console"></p><ol start=2><li>Nhấn <strong>Create function</strong></li></ol><p><img src=/images/3.lambdafunctions/3.4-fetchinvoicelambda/002-createfunction.png alt="Click Create Function"></p><hr><h4 id=bước-2-cấu-hình-lambda-function>Bước 2: Cấu hình Lambda Function</h4><ol><li><p>Trong phần <strong>Author from scratch</strong>, nhập các thông tin sau:</p><ul><li><strong>Function name</strong>: <code>FetchInvoiceDetailsFunction</code></li><li><strong>Runtime</strong>: <code>Python 3.12</code></li><li><strong>Architecture</strong>: <code>x86_64</code></li><li><strong>Permissions</strong>: Chọn <strong>Use an existing role</strong></li><li><strong>Existing role</strong>: <code>LambdaExecutionRole-AIInvoiceScanner</code></li></ul></li></ol><p><img src=/images/3.lambdafunctions/3.4-fetchinvoicelambda/003-configurefunction.png alt="Configure Function"></p><ol start=2><li>Nhấn <strong>Create function</strong></li></ol><p><img src=/images/3.lambdafunctions/3.4-fetchinvoicelambda/004-finishcreate.png alt="Finish Creating Function"></p><hr><h4 id=bước-3-thêm-mã-nguồn-python>Bước 3: Thêm mã nguồn Python</h4><ol><li>Cuộn xuống phần <strong>Code</strong>, thay nội dung mặc định bằng đoạn mã Python sau:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> boto3
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> json
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> decimal <span style=color:#f92672>import</span> Decimal
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> boto3.dynamodb.conditions <span style=color:#f92672>import</span> Key
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dynamodb <span style=color:#f92672>=</span> boto3<span style=color:#f92672>.</span>resource(<span style=color:#e6db74>&#39;dynamodb&#39;</span>)
</span></span><span style=display:flex><span>table <span style=color:#f92672>=</span> dynamodb<span style=color:#f92672>.</span>Table(<span style=color:#e6db74>&#39;InvoiceData&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>decimal_default</span>(obj):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> isinstance(obj, Decimal):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> float(obj)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>lambda_handler</span>(event, context):
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;DEBUG EVENT:&#34;</span>, json<span style=color:#f92672>.</span>dumps(event))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    headers <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;Access-Control-Allow-Origin&#34;</span>: <span style=color:#e6db74>&#34;*&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;Access-Control-Allow-Credentials&#34;</span>: <span style=color:#66d9ef>True</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;Access-Control-Allow-Headers&#34;</span>: <span style=color:#e6db74>&#34;*&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;Access-Control-Allow-Methods&#34;</span>: <span style=color:#e6db74>&#34;OPTIONS,GET,PATCH&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        http_method <span style=color:#f92672>=</span> event<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;httpMethod&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>        resource <span style=color:#f92672>=</span> event<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;resource&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>        path_params <span style=color:#f92672>=</span> event<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;pathParameters&#34;</span>) <span style=color:#f92672>or</span> {}
</span></span><span style=display:flex><span>        invoice_id <span style=color:#f92672>=</span> path_params<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;id&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># === PATCH /invoice/starred/{id} ===</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> http_method <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;PATCH&#34;</span> <span style=color:#f92672>and</span> invoice_id <span style=color:#f92672>and</span> resource <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;/invoice/starred/</span><span style=color:#e6db74>{id}</span><span style=color:#e6db74>&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> event<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;body&#34;</span>):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;statusCode&#39;</span>: <span style=color:#ae81ff>400</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;headers&#39;</span>: headers,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;body&#39;</span>: json<span style=color:#f92672>.</span>dumps({<span style=color:#e6db74>&#39;error&#39;</span>: <span style=color:#e6db74>&#39;Body không được để trống&#39;</span>})
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># Kiểm tra tồn tại invoice</span>
</span></span><span style=display:flex><span>            existing <span style=color:#f92672>=</span> table<span style=color:#f92672>.</span>get_item(Key<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#39;InvoiceId&#39;</span>: invoice_id})
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;Item&#39;</span> <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> existing:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;statusCode&#39;</span>: <span style=color:#ae81ff>404</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;headers&#39;</span>: headers,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;body&#39;</span>: json<span style=color:#f92672>.</span>dumps({<span style=color:#e6db74>&#39;error&#39;</span>: <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;Không tìm thấy hóa đơn với ID </span><span style=color:#e6db74>{</span>invoice_id<span style=color:#e6db74>}</span><span style=color:#e6db74>.&#39;</span>})
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            body <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>loads(event[<span style=color:#e6db74>&#34;body&#34;</span>])
</span></span><span style=display:flex><span>            starred <span style=color:#f92672>=</span> body<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;starred&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> isinstance(starred, bool):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;statusCode&#39;</span>: <span style=color:#ae81ff>400</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;headers&#39;</span>: headers,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;body&#39;</span>: json<span style=color:#f92672>.</span>dumps({<span style=color:#e6db74>&#39;error&#39;</span>: <span style=color:#e6db74>&#39;Trường starred phải là boolean&#39;</span>})
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            starred_str <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;true&#34;</span> <span style=color:#66d9ef>if</span> starred <span style=color:#66d9ef>else</span> <span style=color:#e6db74>&#34;false&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            table<span style=color:#f92672>.</span>update_item(
</span></span><span style=display:flex><span>                Key<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#39;InvoiceId&#39;</span>: invoice_id},
</span></span><span style=display:flex><span>                UpdateExpression<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;SET Starred = :starred&#34;</span>,
</span></span><span style=display:flex><span>                ExpressionAttributeValues<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#39;:starred&#39;</span>: starred_str}
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;statusCode&#39;</span>: <span style=color:#ae81ff>200</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;headers&#39;</span>: headers,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;body&#39;</span>: json<span style=color:#f92672>.</span>dumps({<span style=color:#e6db74>&#39;message&#39;</span>: <span style=color:#e6db74>&#39;Cập nhật Starred thành công&#39;</span>, <span style=color:#e6db74>&#39;InvoiceId&#39;</span>: invoice_id, <span style=color:#e6db74>&#39;Starred&#39;</span>: starred_str})
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># === PATCH /invoice/tags/{id} ===</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> http_method <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;PATCH&#34;</span> <span style=color:#f92672>and</span> invoice_id <span style=color:#f92672>and</span> resource <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;/invoice/tags/</span><span style=color:#e6db74>{id}</span><span style=color:#e6db74>&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> event<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;body&#34;</span>):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;statusCode&#39;</span>: <span style=color:#ae81ff>400</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;headers&#39;</span>: headers,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;body&#39;</span>: json<span style=color:#f92672>.</span>dumps({<span style=color:#e6db74>&#39;error&#39;</span>: <span style=color:#e6db74>&#39;Body không được để trống&#39;</span>})
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># Kiểm tra tồn tại invoice</span>
</span></span><span style=display:flex><span>            existing <span style=color:#f92672>=</span> table<span style=color:#f92672>.</span>get_item(Key<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#39;InvoiceId&#39;</span>: invoice_id})
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;Item&#39;</span> <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> existing:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;statusCode&#39;</span>: <span style=color:#ae81ff>404</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;headers&#39;</span>: headers,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;body&#39;</span>: json<span style=color:#f92672>.</span>dumps({<span style=color:#e6db74>&#39;error&#39;</span>: <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;Không tìm thấy hóa đơn với ID </span><span style=color:#e6db74>{</span>invoice_id<span style=color:#e6db74>}</span><span style=color:#e6db74>.&#39;</span>})
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            body <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>loads(event[<span style=color:#e6db74>&#34;body&#34;</span>])
</span></span><span style=display:flex><span>            tags <span style=color:#f92672>=</span> body<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;tags&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> isinstance(tags, list):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;statusCode&#39;</span>: <span style=color:#ae81ff>400</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;headers&#39;</span>: headers,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;body&#39;</span>: json<span style=color:#f92672>.</span>dumps({<span style=color:#e6db74>&#39;error&#39;</span>: <span style=color:#e6db74>&#39;Tags phải là một mảng&#39;</span>})
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            table<span style=color:#f92672>.</span>update_item(
</span></span><span style=display:flex><span>                Key<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#39;InvoiceId&#39;</span>: invoice_id},
</span></span><span style=display:flex><span>                UpdateExpression<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;SET Tags = :tags&#34;</span>,
</span></span><span style=display:flex><span>                ExpressionAttributeValues<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#39;:tags&#39;</span>: tags}
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;statusCode&#39;</span>: <span style=color:#ae81ff>200</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;headers&#39;</span>: headers,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;body&#39;</span>: json<span style=color:#f92672>.</span>dumps({<span style=color:#e6db74>&#39;message&#39;</span>: <span style=color:#e6db74>&#39;Cập nhật Tags thành công&#39;</span>, <span style=color:#e6db74>&#39;InvoiceId&#39;</span>: invoice_id, <span style=color:#e6db74>&#39;Tags&#39;</span>: tags})
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># === GET /invoice/starred ===</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> http_method <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;GET&#34;</span> <span style=color:#f92672>and</span> resource <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;/invoice/starred&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>                response <span style=color:#f92672>=</span> table<span style=color:#f92672>.</span>query(
</span></span><span style=display:flex><span>                    IndexName<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;StarredInvoicesIndex&#34;</span>,
</span></span><span style=display:flex><span>                    KeyConditionExpression<span style=color:#f92672>=</span>Key(<span style=color:#e6db74>&#34;IsStarred&#34;</span>)<span style=color:#f92672>.</span>eq(<span style=color:#e6db74>&#34;true&#34;</span>)
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>                items <span style=color:#f92672>=</span> response<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;Items&#34;</span>, [])
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;statusCode&#39;</span>: <span style=color:#ae81ff>200</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;headers&#39;</span>: headers,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;body&#39;</span>: json<span style=color:#f92672>.</span>dumps(items, default<span style=color:#f92672>=</span>decimal_default)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;statusCode&#39;</span>: <span style=color:#ae81ff>500</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;headers&#39;</span>: headers,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;body&#39;</span>: json<span style=color:#f92672>.</span>dumps({<span style=color:#e6db74>&#39;error&#39;</span>: <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;Lỗi truy vấn StarredInvoicesIndex: </span><span style=color:#e6db74>{</span>str(e)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>})
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># === GET /invoice/{id} ===</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> invoice_id <span style=color:#f92672>and</span> http_method <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;GET&#34;</span>:
</span></span><span style=display:flex><span>            response <span style=color:#f92672>=</span> table<span style=color:#f92672>.</span>get_item(Key<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#39;InvoiceId&#39;</span>: invoice_id})
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;Item&#39;</span> <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> response:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;statusCode&#39;</span>: <span style=color:#ae81ff>404</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;headers&#39;</span>: headers,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;body&#39;</span>: json<span style=color:#f92672>.</span>dumps({<span style=color:#e6db74>&#39;error&#39;</span>: <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;Không tìm thấy hóa đơn với ID </span><span style=color:#e6db74>{</span>invoice_id<span style=color:#e6db74>}</span><span style=color:#e6db74>.&#39;</span>})
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;statusCode&#39;</span>: <span style=color:#ae81ff>200</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;headers&#39;</span>: headers,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;body&#39;</span>: json<span style=color:#f92672>.</span>dumps(response[<span style=color:#e6db74>&#39;Item&#39;</span>], default<span style=color:#f92672>=</span>decimal_default)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># === GET /invoice?name=... ===</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> http_method <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;GET&#34;</span> <span style=color:#f92672>and</span> event<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;queryStringParameters&#39;</span>) <span style=color:#f92672>and</span> event[<span style=color:#e6db74>&#39;queryStringParameters&#39;</span>]<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;name&#39;</span>):
</span></span><span style=display:flex><span>            name <span style=color:#f92672>=</span> event[<span style=color:#e6db74>&#39;queryStringParameters&#39;</span>][<span style=color:#e6db74>&#39;name&#39;</span>]
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>                response <span style=color:#f92672>=</span> table<span style=color:#f92672>.</span>query(
</span></span><span style=display:flex><span>                    IndexName<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;CustomerName-index&#39;</span>,
</span></span><span style=display:flex><span>                    KeyConditionExpression<span style=color:#f92672>=</span>Key(<span style=color:#e6db74>&#39;CustomerName&#39;</span>)<span style=color:#f92672>.</span>eq(name)
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>                items <span style=color:#f92672>=</span> response<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;Items&#39;</span>, [])
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;statusCode&#39;</span>: <span style=color:#ae81ff>500</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;headers&#39;</span>: headers,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;body&#39;</span>: json<span style=color:#f92672>.</span>dumps({<span style=color:#e6db74>&#39;error&#39;</span>: <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;Lỗi truy vấn CustomerName: </span><span style=color:#e6db74>{</span>str(e)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>})
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> items:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;statusCode&#39;</span>: <span style=color:#ae81ff>404</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;headers&#39;</span>: headers,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;body&#39;</span>: json<span style=color:#f92672>.</span>dumps({<span style=color:#e6db74>&#39;error&#39;</span>: <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;Không tìm thấy hóa đơn với tên khách hàng </span><span style=color:#e6db74>{</span>name<span style=color:#e6db74>}</span><span style=color:#e6db74>.&#39;</span>})
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;statusCode&#39;</span>: <span style=color:#ae81ff>200</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;headers&#39;</span>: headers,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;body&#39;</span>: json<span style=color:#f92672>.</span>dumps(items, default<span style=color:#f92672>=</span>decimal_default)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># === GET /invoice (tất cả) ===</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> http_method <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;GET&#34;</span>:
</span></span><span style=display:flex><span>            response <span style=color:#f92672>=</span> table<span style=color:#f92672>.</span>scan()
</span></span><span style=display:flex><span>            items <span style=color:#f92672>=</span> response<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;Items&#39;</span>, [])
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;statusCode&#39;</span>: <span style=color:#ae81ff>200</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;headers&#39;</span>: headers,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;body&#39;</span>: json<span style=color:#f92672>.</span>dumps(items, default<span style=color:#f92672>=</span>decimal_default)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;statusCode&#39;</span>: <span style=color:#ae81ff>400</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;headers&#39;</span>: headers,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;body&#39;</span>: json<span style=color:#f92672>.</span>dumps({<span style=color:#e6db74>&#39;error&#39;</span>: <span style=color:#e6db74>&#39;Phương thức không được hỗ trợ&#39;</span>})
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;statusCode&#39;</span>: <span style=color:#ae81ff>500</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;headers&#39;</span>: headers,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;body&#39;</span>: json<span style=color:#f92672>.</span>dumps({<span style=color:#e6db74>&#39;error&#39;</span>: str(e)})
</span></span><span style=display:flex><span>        }
</span></span></code></pre></div><p><img src=/images/3.lambdafunctions/3.4-fetchinvoicelambda/005-code.png alt="Paste Source Code"></p><ol start=2><li>Nhấn <strong>Deploy</strong> để lưu và áp dụng đoạn mã nguồn.</li></ol><p><img src=/images/3.lambdafunctions/3.4-fetchinvoicelambda/006-deploy.png alt=Deploy></p><hr><h4 id=bước-4-cấu-hình-timeout-và-memory>Bước 4: Cấu hình Timeout và Memory</h4><ol><li>Vào <strong>Configuration > General configuration</strong>, nhấn <strong>Edit</strong>.</li></ol><p><img src=/images/3.lambdafunctions/3.4-fetchinvoicelambda/007-editconfig.png alt="Edit General Configuration"></p><ol start=2><li><p>Cấu hình thông tin như sau:</p><ul><li><strong>Description</strong>: <code>Retrieves invoice data from DynamoDB based on invoice ID via API Gateway request</code></li><li><strong>Memory (MB)</strong>: 128</li><li><strong>Timeout</strong>: 3 seconds</li></ul></li></ol><p><img src=/images/3.lambdafunctions/3.4-fetchinvoicelambda/008-settimeout.png alt="Set Memory and Timeout"></p><ol start=3><li>Nhấn <strong>Save</strong>.</li></ol><p><img src=/images/3.lambdafunctions/3.4-fetchinvoicelambda/009-clicksave.png alt="Click Save"></p><hr><h4 id=kết-luận>Kết luận</h4><p>Bạn đã tạo xong Lambda Function <strong>FetchInvoiceDetailsFunction</strong>, dùng để xử lý việc truy vấn và cập nhật dữ liệu hóa đơn từ DynamoDB. Function này sẽ được kết nối với API Gateway để phục vụ các yêu cầu từ phía frontend.</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/vi/3-aipoweredinvoiceprocessing/3.3-testlambdafunction-upload/ title="Kiểm thử Lambda Function #1"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/vi/3-aipoweredinvoiceprocessing/3.5-testlambdafunction-fetch/ title="Kiểm thử Lambda Function #2" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1754755521></script><script src=/js/perfect-scrollbar.min.js?1754755521></script><script src=/js/perfect-scrollbar.jquery.min.js?1754755521></script><script src=/js/jquery.sticky.js?1754755521></script><script src=/js/featherlight.min.js?1754755521></script><script src=/js/highlight.pack.js?1754755521></script><script>hljs.initHighlightingOnLoad()</script><script src=/js/modernizr.custom-3.6.0.js?1754755521></script><script src=/js/learn.js?1754755521></script><script src=/js/hugo-learn.js?1754755521></script><link href=/mermaid/mermaid.css?1754755521 rel=stylesheet><script src=/mermaid/mermaid.js?1754755521></script><script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-158079754-2","auto"),ga("send","pageview")</script></body></html>